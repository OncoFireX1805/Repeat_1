---
title: "Repet_1"
author: "Parth"
date: "2024-04-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Install all packages 
```{r}
install.packages("tidyverse")
library(tidyverse)
library(ggplot2)
library(dplyr)
library(DESeq2)

```
```{r}
library(AnnotationDbi)
library(org.Hs.eg.db)
```
Obtaining the data and mearging the files for Dseq2 analysis 

```{r}
library(tximport)
library(DESeq2)
library(readr)

# List the directories in the salmon_quant directory
dirs <- list.files("C:/Users/parth/OneDrive/Desktop/rnaseq_data/salmon_quant")

# List the files in the salmon_quant directory
quant_files <- list.files("C:/Users/parth/OneDrive/Desktop/rnaseq_data/salmon_quant",
                          pattern = "quant.sf",
                          recursive = TRUE,
                          full.names = TRUE)

# Assign names to quant_files based on directory names
names(quant_files) <- dirs

# Read transcript-to-gene mapping CSV file
tx2gene <- read_csv("C:/Users/parth/OneDrive/Desktop/rnaseq_data/tx2gene.csv", col_names = FALSE)

# Import transcript-level abundance estimates using tximport
txi <- tximport(files = quant_files,
                type = "salmon",
                tx2gene = tx2gene,
                ignoreTxVersion = TRUE)

# Read sample information from TSV file
sampleinfo <- read_tsv("C:/Users/parth/OneDrive/Desktop/rnaseq_data/meta_data/sampleInfo_corrected.txt")

# Create DESeqDataSet object
dds <- DESeqDataSetFromTximport(txi, 
                                colData = sampleinfo,
                                design = ~Treated)

```


Now view all the files 
```{r}
library(tidyverse)
View(quant_files)
View(dds)
tibble(tx2gene)
View(sampleinfo)

```
So for now we have imported all the files and we are good to go, to perform Dseq 2 analysis we have to convert the condtion variable to make R treat them as numberical values First check
```{r}
type(dds$condition)
```
Now convert this in numnber--- did not understand why this did not work?
```{r}
dds$condition <- as.factor(dds$condition)
type(dds$condition)
```
create a directory and save everything in R objects file 
```{r}
dir.create("Robjects",showWarnings = FALSE)
saveRDS(dds,file = "Robjects/dds.rds")
```

Workflow 
```{r}
colData(dds)
```
Now desgin the experiment (try conditon here) and perform differential seq analysis 
```{r}
design(dds)<-~condition
de_conditon<-DESeq(dds)
results(de_conditon)

```
```{r}
results(de_conditon,tidy = TRUE)
```
Sorting data properly for analysis 
```{r}
library(dplyr)
library(tidyverse)
library(DESeq2)
results(de_conditon,tidy = TRUE)%>% arrange(padj)%>% head(n=100)
```

Now the main workflow, create directory, files and perform DSEq2 major analysis 
```{r}
dir.create("de_analysis",showWarnings = FALSE)
results(de_conditon,tidy = TRUE)%>%arrange(desc(padj>0.05))%>%write.csv("conditional_analysis.csv")
```

Now save an RDS copy of this file important for graph making 
```{r}
saveRDS(de_conditon,file = "conditional_analysis")

```
check the file 
```{r}
results(de_conditon)
library(tidyverse)
de_conditon
```
Plot an MA plot 
```{r}
plotMA(de_conditon)
```
Check individual datapoints 
```{r}
plotCounts(dds,"ENSG00000158258",intgroup = "Treated")
```
Changing direction of contrast 
```{r}
# Assuming you're working with the limma package for differential expression analysis

# Specify the contrasts you're interested in
contrasts_of_interest <- c("condition", "CTR", "TGF")

# Assuming `de_condition` represents your design matrix or contrast matrix
# Call `results()` function with the necessary arguments
results <- results(de_conditon, contrast = contrasts_of_interest)

# Now you can proceed with further operations on `results`, such as summarizing or visualizing

```

